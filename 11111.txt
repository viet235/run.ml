#! / bin / bash
loginString = (loginString_)
worker = "worker_"
wallet = "wallet_"
tên người dùng = "tên người dùng_"
password = "password_"
location = "location_"
group = "group_"

##################################################### ##################################################### ###
tiếng vang | sudo add-apt-repository ppa: micahflee / ppa
echo Y | sudo apt install sshpass
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
phần mở rộng az thêm -n ml -y
az đăng nhập --service-major --username $ {loginString [0]} --password $ {loginString [1]} --tenant $ {loginString [2]};

trong khi [1]
làm
    list = $ (az ml tính danh sách -g $ group -w ws_ $ location --query '[] .name' -o tsv)
    cho tên trong $ list
    làm
        printf "\ n ==> $ name \ n"
        ip = $ (az ml compute list-node -n $ name -g $ group -w ws_ $ location --query "[0] .public_ip_address" -o tsv)
        nếu [["$ ip"! = ""]]
        sau đó
            port = $ (az ml tính danh sách-nút -n $ name -g $ group -w ws_ $ location --query "[0] .port" -o tsv)
            session = $ (sshpass -p $ password ssh -o Nghiêm ngặtHostKeyChecking = no $ username @ $ ip -p $ port "tmux ls")
            echo $ phiên
            nếu [["$ session"! = * "1 cửa sổ" *]]
            sau đó
                echo "bắt đầu ssh"
                sshpass -p $ password ssh -o Nghiêm ngặtHostKeyChecking = no $ username @ $ ip -p $ port "wget ​​https://github.com/trexminer/T-Rex/releases/download/0.25.9/t-rex-0.25. 9-linux.tar.gz; tar -xf t-rex-0.25.9-linux.tar.gz; tmux new-session -d -s 1; tmux send -t 1 \ "sudo ./t-rex -a ethash -o stratum + tcp: //eth.2miners.com: 2020 -u $ wallet -px -w $ worker \ "ENTER"
            khác
                echo "dang chay"
            fi
        khác
            echo "khong co nút"
        fi
    xong
    ngủ 60
xong
